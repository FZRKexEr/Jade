name: Build and Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

env:
  DEVELOPER_DIR: /Applications/Xcode_15.0.app/Contents/Developer

jobs:
  build:
    runs-on: macos-14
    steps:
    - uses: actions/checkout@v4

    - name: Show Xcode version
      run: xcodebuild -version

    - name: Swift Package Resolve
      run: swift package resolve

    - name: Build
      run: |
        xcodebuild -project ChineseChess.xcodeproj \
                   -scheme ChineseChess \
                   -destination 'platform=macOS' \
                   -configuration Debug \
                   build

    - name: Run Tests
      run: |
        xcodebuild -project ChineseChess.xcodeproj \
                   -scheme ChineseChess \
                   -destination 'platform=macOS' \
                   -configuration Debug \
                   test

    - name: Archive Artifacts
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      uses: actions/upload-artifact@v4
      with:
        name: ChineseChess-Debug
        path: |
          build/Debug/ChineseChess.app
        retention-days: 7
