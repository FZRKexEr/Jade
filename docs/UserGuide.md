# 用户手册

本文档提供中国象棋 macOS 应用的完整功能说明。

## 目录

- [界面布局](#界面布局)
- [菜单功能](#菜单功能)
- [棋盘操作](#棋盘操作)
- [引擎设置](#引擎设置)
- [时间控制](#时间控制)
- [棋谱管理](#棋谱管理)
- [分析模式](#分析模式)

## 界面布局

应用主界面由多个区域组成：

```
┌─────────────────────────────────────────────────────────────┐
│ 菜单栏 (文件 编辑 视图 引擎 窗口 帮助)                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│     ┌─────────┐    ┌───────────────────────┐    ┌─────────┐  │
│     │  工具   │    │                       │    │  引擎   │  │
│     │  栏     │    │      中 国 象 棋      │    │  面板   │  │
│     │         │    │                       │    │         │  │
│     │ 新局    │    │                       │    │ 评估:   │  │
│     │ 悔棋    │    │     楚河     汉界      │    │ +0.35   │  │
│     │ 提示    │    │                       │    │         │  │
│     │ 保存    │    │                       │    │ 思考线: │  │
│     │         │    │                       │    │ ...     │  │
│     └─────────┘    └───────────────────────┘    └─────────┘  │
│                                                             │
│     ┌─────────────────────────┬─────────────────────────┐  │
│     │       着 法 列 表         │       状 态 栏          │  │
│     │                           │  红方 用时: 05:32       │  │
│     │ 1. 炮二平五  马8进7      │  黑方 用时: 04:18       │  │
│     │ 2. 马二进三  车9平8      │                         │  │
│     │                           │                         │  │
│     └─────────────────────────┴─────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 各区域说明

#### 1. 棋盘区（中央）

- 显示中国象棋棋盘和棋子
- 支持点击和拖拽两种走子方式
- 最后一步会高亮显示
- 选中棋子会显示可移动位置（设置中可开启）

#### 2. 工具栏（左侧）

常用操作的快捷按钮：

| 按钮 | 功能 | 快捷键 |
|------|------|--------|
| 新局 | 开始新对局 | `Cmd+N` |
| 悔棋 | 撤销上一步 | `Cmd+Z` |
| 重做 | 恢复上一步 | `Cmd+Shift+Z` |
| 提示 | 请求引擎提示 | `Cmd+H` |
| 保存 | 保存棋谱 | `Cmd+S` |

#### 3. 引擎面板（右侧）

显示引擎分析信息（需要连接引擎）：

- **评估值**: 当前局面对红方的评估（+ 表示红方优势，- 表示黑方优势）
- **思考线**: 引擎计算的后续着法序列
- **搜索深度**: 引擎计算的深度
- **每秒节点数**: 引擎计算速度

#### 4. 着法列表（下方左侧）

显示对局的所有着法记录：

```
1. 炮二平五  马8进7
2. 马二进三  车9平8
3. 车一平二  马2进3
...
```

可以点击任意着法跳转到该位置。

#### 5. 状态栏（下方右侧）

显示对局状态信息：

- 当前回合
- 红方用时
- 黑方用时
- 当前局面结果（如果有）

## 菜单功能

### 文件菜单

```
文件
├── 新局              Cmd+N
├── 打开              Cmd+O
├── 打开最近使用       >
├── 保存              Cmd+S
├── 另存为...         Cmd+Shift+S
├── 导出 PGN
├── ─────────────
├── 页面设置...
├── 打印...           Cmd+P
├── ─────────────
└── 退出              Cmd+Q
```

#### 新局 (Cmd+N)

开始一局新的对局：

- 设置红方和黑方的玩家类型（人类或引擎）
- 如果一方是引擎，可以设置难度
- 选择是否启用时间控制
- 设置棋盘初始局面（默认为标准开局）

#### 打开 (Cmd+O)

打开已保存的棋谱文件：

- 支持格式：`.pgn`, `.xiangqi`
- 可以同时加载多个棋谱文件

#### 保存 / 另存为

保存当前对局：

- 首次保存时会提示选择位置和文件名
- 支持保存为 PGN 格式或自定义格式
- 可以编辑棋谱元数据（对局者、日期、事件等）

#### 导出 PGN

将当前对局导出为标准 PGN 格式，方便在其他软件中打开。

### 编辑菜单

```
编辑
├── 撤销            Cmd+Z
├── 重做            Cmd+Shift+Z
├── ─────────────
├── 剪切            Cmd+X
├── 复制            Cmd+C
├── 粘贴            Cmd+V
├── 全选            Cmd+A
├── ─────────────
├── 复制局面 (FEN)  Cmd+Shift+C
├── 粘贴局面        Cmd+Shift+V
├── 复制棋谱 (PGN)  Cmd+Option+C
├── 粘贴棋谱        Cmd+Option+V
├── ─────────────
└── 首选项...        Cmd+,
```

#### 悔棋 / 重做

- **悔棋**: 撤销上一步着法，回到之前的状态
- **重做**: 恢复被撤销的着法
- 支持连续多次悔棋/重做
- 人机对战中，悔棋会让引擎重新思考

#### 复制/粘贴局面 (FEN)

使用 FEN 格式复制和粘贴当前局面：

- **复制局面**: 将当前局面复制为 FEN 字符串，可用于其他象棋软件
- **粘贴局面**: 从 FEN 字符串设置棋盘位置

示例 FEN：
```
rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR w - - 0 1
```

#### 复制/粘贴棋谱 (PGN)

使用 PGN 格式复制和粘贴完整棋谱：

- **复制棋谱**: 将当前对局复制为 PGN 格式
- **粘贴棋谱**: 从 PGN 字符串加载完整对局

#### 首选项 (Cmd+,)

打开应用设置面板：

- **通用**: 语言、主题、棋盘样式
- **棋盘**: 显示设置、走子确认、声音
- **引擎**: 默认引擎路径、自动连接
- **快捷键**: 自定义键盘快捷键

### 视图菜单

```
视图
├── 进入/退出全屏     Cmd+Ctrl+F
├── 最小化            Cmd+M
├── 缩放
│   ├── 放大          Cmd++
│   ├── 缩小          Cmd+-
│   └── 重置          Cmd+0
├── ─────────────
├── 显示/隐藏引擎面板
├── 显示/隐藏着法列表
├── 显示/隐藏工具栏
├── 显示/隐藏状态栏
├── ─────────────
├── 棋盘样式
│   ├── 传统风格
│   ├── 现代风格
│   └── 木纹风格
├── 翻转棋盘
├── 显示可移动位置
└── 显示最后一步
```

#### 全屏模式

- 进入全屏: `Cmd+Ctrl+F` 或点击绿色全屏按钮
- 退出全屏: 再次按 `Cmd+Ctrl+F` 或按 `Esc`
- 全屏模式下可以隐藏所有面板，获得沉浸式的对弈体验

#### 面板显示控制

可以独立显示/隐藏各个面板：

- **引擎面板**: 显示引擎分析信息
- **着法列表**: 显示着法记录
- **工具栏**: 显示快捷操作按钮
- **状态栏**: 显示对局状态和时间

#### 棋盘样式

三种棋盘主题可供选择：

| 样式 | 特点 |
|------|------|
| 传统风格 | 经典中式设计，适合传统爱好者 |
| 现代风格 | 简洁现代设计，适合现代审美 |
| 木纹风格 | 仿木材质感，视觉舒适 |

#### 翻转棋盘

点击菜单 **视图 > 翻转棋盘** 可以将棋盘旋转 180 度，方便从黑方角度观察局面。

#### 显示设置

- **显示可移动位置**: 选中棋子时高亮显示所有可移动位置
- **显示最后一步**: 高亮显示上一步的起始和目标位置

### 引擎菜单

```
引擎
├── 连接引擎
├── 断开引擎
├── 重新连接
├── ─────────────
├── 引擎选项...
├── 引擎管理...
├── ─────────────
├── 分析模式      Cmd+T
├── 停止分析      Cmd+.
├── 提示          Cmd+H
└── 多引擎分析
```

#### 连接引擎

1. 点击菜单 **引擎 > 连接引擎**
2. 在弹出的对话框中选择引擎可执行文件
3. 点击"连接"

如果这是首次配置引擎，建议先下载并配置 Pikafish：
- 点击 **引擎 > 引擎管理 > 下载 Pikafish**
- 或参考 [安装指南](Installation.md#引擎配置) 手动配置

#### 引擎选项

配置引擎参数：

| 参数 | 说明 | 推荐值 |
|------|------|--------|
| Hash | 引擎使用的哈希表大小（MB）| 256-1024 |
| Threads | 引擎使用的 CPU 线程数 | 2-4 |
| Skill Level | 引擎强度等级（0-20）| 根据对手水平 |
| UCI_Variant | 变体类型 | xiangqi |

#### 分析模式

- **开始分析**: `Cmd+T` 或菜单 **引擎 > 分析模式**
- **停止分析**: `Cmd+.` 或菜单 **引擎 > 停止分析**

分析模式下，引擎会持续计算当前局面的最佳着法，并在引擎面板显示分析结果。

#### 提示功能

请求引擎给出当前最佳着法提示：

1. 确保轮到你走棋
2. 点击菜单 **引擎 > 提示** 或按 `Cmd+H`
3. 等待引擎计算
4. 最佳着法会高亮显示在棋盘上

### 窗口菜单

```
窗口
├── 最小化          Cmd+M
├── 缩放
├── ─────────────
├── 显示主窗口
├── 显示引擎窗口
├── 显示分析窗口
├── ─────────────
├── 重置布局
├── 保存布局
├── 加载布局
└── 进入全屏       Cmd+Ctrl+F
```

### 帮助菜单

```
帮助
├── 帮助...         Cmd+?
├── 快捷键参考
├── 查看日志
├── ─────────────
├── 在线文档
├── 检查更新...
├── ─────────────
└── 关于中国象棋
```

## 棋谱管理

### 棋谱格式说明

应用支持 PGN (Portable Game Notation) 格式，这是国际通用的象棋棋谱标准格式。

#### PGN 文件结构

```pgn
[Event "友谊赛"]
[Site "北京"]
[Date "2024.01.15"]
[Round "1"]
[Red "张三"]
[Black "李四"]
[Result "1-0"]

1. 炮二平五 马8进7
2. 马二进三 车9平8
3. 车一平二 马2进3
4. 兵七进一 卒7进1
5. 车二进六 ...
```

#### 标签说明

| 标签 | 说明 |
|------|------|
| Event | 比赛/活动名称 |
| Site | 比赛地点 |
| Date | 比赛日期（YYYY.MM.DD）|
| Round | 轮次 |
| Red | 红方姓名 |
| Black | 黑方姓名 |
| Result | 结果（1-0 红胜，0-1 黑胜，1/2-1/2 和棋，* 未完成）|

#### 着法记录规则

- **棋子**: 车(R)、马(N)、象(B)、士(A)、将(K)、炮(C)、兵(P)
- **移动方向**: 进(+)、退(-)、平(=)
- **数字**: 第几列（从右到左 1-9）

示例：
- `炮二平五`: 第 2 列的炮平移到第 5 列
- `马8进7`: 第 8 列的马前进到第 7 列
- `车9平8`: 第 9 列的车平移到第 8 列

## 分析模式使用

### 启动分析模式

1. 连接引擎
2. 点击菜单 **引擎 > 分析模式** 或按 `Cmd+T`
3. 引擎面板会显示实时分析信息

### 分析面板说明

```
┌──────────────────────────────┐
│  引擎: Pikafish 14           │
│  深度: 24/40                 │
│  NPS: 1,234,567              │
│  时间: 2.3s                  │
├──────────────────────────────┤
│  评估: +0.35 (红方优势)      │
├──────────────────────────────┤
│  主变线:                     │
│  1. 炮二平五 马8进7          │
│  2. 马二进三 车9平8          │
│  3. 车一平二 马2进3          │
│  ...                         │
└──────────────────────────────┘
```

| 信息 | 说明 |
|------|------|
| 深度 | 引擎搜索的深度（当前深度/最大深度）|
| NPS | 每秒计算的节点数（Nodes Per Second）|
| 时间 | 当前分析所用时间 |
| 评估 | 当前局面对红方的评估值 |
| 主变线 | 引擎推荐的最佳着法序列 |

### 评估值解读

评估值表示当前局面的优劣：

| 评估值 | 局面判断 | 胜率估算 |
|--------|----------|----------|
| +3.00 以上 | 红方大优 | 红方 90%+ |
| +1.50 ~ +3.00 | 红方优势 | 红方 70-90% |
| +0.50 ~ +1.50 | 红方稍优 | 红方 55-70% |
| -0.50 ~ +0.50 | 均势 | 50% 左右 |
| -1.50 ~ -0.50 | 黑方稍优 | 黑方 55-70% |
| -3.00 ~ -1.50 | 黑方优势 | 黑方 70-90% |
| -3.00 以下 | 黑方大优 | 黑方 90%+ |

### 停止分析

点击菜单 **引擎 > 停止分析** 或按 `Cmd+.` 停止引擎分析。

### 在走子后继续分析

在分析模式下走子后，引擎会自动开始分析新局面的最佳着法。

### 多局面分析

可以分析多个相关局面：

1. 在分析模式下，使用悔棋/重做浏览不同局面
2. 每个局面引擎都会重新计算
3. 对比不同局面的评估值变化

---

*继续阅读 [引擎配置指南](EngineGuide.md) 了解如何配置和优化引擎。*
